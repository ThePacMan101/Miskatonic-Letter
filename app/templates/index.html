<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Miskatonic Letter · Occult & Conspiracy Forum</title>
  <link rel="stylesheet" href="{{ url_for('static', path='styles.css') }}" />
</head>
<body>
  <header class="topbar">
    <div class="container topbar__inner">

      <!-- LOGO -->
      <a class="brand" href="{{ url_for('get_posts') }}">
        <img src="{{ url_for('static', path='imgs/elder-sign.png') }}" alt="" class="brand__logo" aria-hidden="true">
        <span class="brand__name">Miskatonic<span class="accent">Letter</span></span>
      </a>

      <!-- SEARCH BAR -->
      <form class="search" action="{{ url_for('get_posts') }}" method="get" role="search">
        <input class="search__input" type="search" name="q" value="{{ q }}" placeholder="Search theories, rituals, manifestos…" aria-label="Search" />
      </form>

      <!-- LOGIN/REGISTER -->
      <nav class="usernav" aria-label="User">
        <a class="btn btn--ghost" href="#">Login</a>
        <a class="btn btn--primary" href="#">Join the Circle</a>
      </nav>
    </div>
  </header>

  <!-- Page -->
  <main class="container layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <section class="card">
        <h2 class="card__title">Categories</h2>
        <nav class="list list--links">
          <a href="#" class="list__item is-active">All Posts</a>
          <a href="#" class="list__item">Conspiracy Theories</a>
          <a href="#" class="list__item">Occult Rituals</a>
          <a href="#" class="list__item">Secret Societies</a>
          <a href="#" class="list__item">Political</a>
          <a href="#" class="list__item">Paranormal Events</a>
          <a href="#" class="list__item">Forbidden Knowledge</a>
        </nav>
      </section>

      <section class="card">
        <h2 class="card__title">Trending Tags</h2>
        <div class="tags">
          <a href="#" class="tag">illuminati</a>
          <a href="#" class="tag">ritual</a>
          <a href="#" class="tag">y2k</a>
          <a href="#" class="tag">mkultra</a>
          <a href="#" class="tag">eldritch</a>
          <a href="#" class="tag">freemason</a>
          <a href="#" class="tag">alien</a>
          <a href="#" class="tag">deepstate</a>
          <a href="#" class="tag">prophecy</a>
        </div>
      </section>

      <section class="card">
        <h2 class="card__title">Stats</h2>
        <ul class="meta">
          <li><span>Initiates</span><strong>7,666</strong></li>
          <li><span>Threads</span><strong>23,401</strong></li>
          <li><span>Active</span><strong>314</strong></li>
        </ul>
      </section>
              <nav class="pagination" aria-label="Pagination">
          {% set pages = [1] %}
          {% if page - 1 > 1 %}
            {% set _ = pages.append(page - 1) %}
          {% endif %}
          {% if page != 1 and page != total_pages %}
            {% set _ = pages.append(page) %}
          {% endif %}
          {% if page + 1 < total_pages %}
            {% set _ = pages.append(page + 1) %}
          {% endif %}
          {% if total_pages > 1 %}
            {% set _ = pages.append(total_pages) %}
          {% endif %}
          {% set pages = pages | unique | sort %}
          {% if page > 1 %}
            <a class="page" href="{{ url_for('get_posts') }}?page={{ page - 1 }}{% if q %}&q={{ q }}{% endif %}{% if badge %}&badge={{ badge }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}">Prev</a>
          {% else %}
            <span class="page is-disabled">Prev</span>
          {% endif %}
          {% for p in pages %}
          {% if p == page %}
            <span class="page is-current">{{ p }}</span>
          {% else %}
            <a class="page" href="{{ url_for('get_posts') }}?page={{ p }}{% if q %}&q={{ q }}{% endif %}{% if badge %}&badge={{ badge }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}">{{ p }}</a>
          {% endif %}
          {# Show ellipsis if there is a gap to the next page #}
          {% if not loop.last and pages[loop.index] - p > 1 %}
            <span class="page page--dots">…</span>
          {% endif %}
          {% endfor %}
          {% if page < total_pages %}
            <a class="page" href="{{ url_for('get_posts') }}?page={{ page + 1 }}{% if q %}&q={{ q }}{% endif %}{% if badge %}&badge={{ badge }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}">Next</a>
          {% else %}
            <span class="page is-disabled">Next</span>
          {% endif %}
        </nav>
    </aside>

    <!-- Content -->
    <section class="content">
      <div class="bar">
        <div class="chips">
          {% for badge in popular_badges %}
            <a
              class="chip{% if request.query_params.get('badge') == badge.label %} is-selected{% endif %}"
              href="{{ url_for('get_posts') }}?badge={{ badge.label }}{% if q %}&q={{ q }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}"
            >{{ badge.title }}</a>
          {% endfor %}
          <a
            class="chip{% if not request.query_params.get('badge') %} is-selected{% endif %}"
            href="{{ url_for('get_posts') }}{% if q %}?q={{ q }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}"
          >All</a>
        </div>
        <div class="filters">
          <label class="select">
            <span class="select__label">Sort</span>
              <form class="search" action="{{ url_for('get_posts') }}" method="get" role="search">
                <input type="hidden" name="q" value="{{ q }}">
                <input type="hidden" name="page" value="{{ page }}">
                <select name="sort" onchange="this.form.submit()">
                  <option value="newest" {% if request.query_params.get('sort', 'newest') == 'newest' %}selected{% endif %}>Newest</option>
                  <option value="views" {% if request.query_params.get('sort') == 'views' %}selected{% endif %}>Views</option>
                </select>
              </form>
          </label>
        </div>
      </div>

      <div class="threads" role="feed" aria-busy="false">
        {% for post in posts %}
          <article class="thread card" role="article">
            <div class="thread__main">
              <div class="thread__row">
                <span class="badge badge--{{ post.badge.label }}" title="{{ post.badge.title }}">{{ post.badge.label }}</span>
                <a href="{{ url_for('get_post', id=post.id) }}" class="thread__title" data-id="{{ post.id }}">{{ post.title }}</a>
              </div>
              <p class="thread__excerpt">{{ post.exerpt }}</p>
              <div class="thread__meta">
                <span class="author">
                  <span class="avatar" aria-hidden="true">{{ post.author.avatar }}</span>
                  <a href="#" class="author__name">{{ post.author.name }}</a>
                </span>
                <time datetime="{{ post.date }}">{{ post.date }}</time>
                <span class="dot" aria-hidden="true">•</span>
                {% for tag in post.tags %}
                  <a href="#" class="tag">{{ tag }}</a>
                {% endfor %}
              </div>
            </div>
            <ul class="thread__stats">
              <li><span class="stat__label">Views</span><strong>{{ post.stats.views }}</strong></li>
              <li><span class="stat__label">Replies</span><strong>{{ post.stats.replies }}</strong></li>
              <li><span class="stat__label">Credibility</span><strong>{{ post.stats.credibility }}</strong></li>
            </ul>
          </article>
        {% endfor %}
        </div>
    </section>
  </main>


  <footer class="footer">
    <div class="container footer__inner">
      <p>© 1994 Miskatonic Letter.</p>
      <nav class="footer__links">
        <a href="#">Forum Charter</a>
        <a href="#">Occult FAQ</a>
        <a href="#">Contact the Admins</a>
      </nav>
    </div>
  </footer>
</body>
</html>
