<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Miskatonic Letter · Occult & Conspiracy Forum</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Top Nav -->
  <header class="topbar">
    <div class="container topbar__inner">
      <a class="brand" href="#">
        <!-- logo image -->
        <img src="imgs/elder-sign.png" alt="" class="brand__logo" aria-hidden="true">
        <span class="brand__name">Miskatonic<span class="accent">Letter</span></span>
      </a>


      <form class="search" action="#" method="get" role="search">
        <input class="search__input" type="search" name="q" placeholder="Search theories, rituals, manifestos…" aria-label="Search" />
      </form>

      <nav class="usernav" aria-label="User">
        <a class="btn btn--ghost" href="#">Login</a>
        <a class="btn btn--primary" href="#">Join the Circle</a>
      </nav>
    </div>
  </header>

  <!-- Page -->
  <main class="container layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <section class="card">
        <h2 class="card__title">Categories</h2>
        <nav class="list list--links">
          <a href="#" class="list__item is-active">All Posts</a>
          <a href="#" class="list__item">Conspiracy Theories</a>
          <a href="#" class="list__item">Occult Rituals</a>
          <a href="#" class="list__item">Secret Societies</a>
          <a href="#" class="list__item">Political</a>
          <a href="#" class="list__item">Paranormal Events</a>
          <a href="#" class="list__item">Forbidden Knowledge</a>
        </nav>
      </section>

      <section class="card">
        <h2 class="card__title">Trending Tags</h2>
        <div class="tags">
          <a href="#" class="tag">illuminati</a>
          <a href="#" class="tag">ritual</a>
          <a href="#" class="tag">y2k</a>
          <a href="#" class="tag">mkultra</a>
          <a href="#" class="tag">eldritch</a>
          <a href="#" class="tag">freemason</a>
          <a href="#" class="tag">alien</a>
          <a href="#" class="tag">deepstate</a>
          <a href="#" class="tag">prophecy</a>
        </div>
      </section>

      <section class="card">
        <h2 class="card__title">Stats</h2>
        <ul class="meta">
          <li><span>Initiates</span><strong>7,666</strong></li>
          <li><span>Threads</span><strong>23,401</strong></li>
          <li><span>Active</span><strong>314</strong></li>
        </ul>
      </section>
    </aside>

    <!-- Content -->
    <section class="content">
      <div class="bar">
        <div class="chips">
          <button class="chip is-selected">Latest</button>
          <button class="chip">Unhinged</button>
          <button class="chip">Occult</button>
          <button class="chip">Extremes</button>
        </div>
        <div class="filters">
          <label class="select">
            <span class="select__label">Sort</span>
            <select>
              <option>Newest</option>
              <option>Most Replies</option>
              <option>Most Disturbing</option>
            </select>
          </label>
        </div>
      </div>

      <!-- Thread List -->
      <div class="threads" id="threads" role="feed" aria-busy="false">
        <!-- Posts will be loaded here by JS -->
      </div>

      <!-- Pagination -->
      <nav class="pagination" id="pagination" aria-label="Pagination">
        <!-- Pagination will be loaded by JS -->
      </nav>
    </section>
  </main>

  <footer class="footer">
    <div class="container footer__inner">
      <p>© 2025 Miskatonic Letter.</p>
      <nav class="footer__links">
        <a href="#">Forum Charter</a>
        <a href="#">Occult FAQ</a>
        <a href="#">Contact the Admins</a>
      </nav>
    </div>
  </footer>

  <script>
    // Config
  const POSTS_PER_PAGE = 5;
    let currentPage = 1;
    let posts = [];

    // Load posts.json
    fetch('posts.json')
      .then(res => res.json())
      .then(data => {
        posts = data;
        renderPosts();
        renderPagination();
      });

    function renderPosts() {
      const threads = document.getElementById('threads');
      threads.innerHTML = '';
      const start = (currentPage - 1) * POSTS_PER_PAGE;
      const end = start + POSTS_PER_PAGE;
      const pagePosts = posts.slice(start, end);
      pagePosts.forEach(post => {
        const article = document.createElement('article');
        article.className = 'thread card';
        article.setAttribute('role', 'article');
        article.innerHTML = `
          <div class="thread__main">
            <div class="thread__row">
              <span class="badge badge--${post.badge.type}" title="${post.badge.title}">${post.badge.label}</span>
              <a href="open-post.html?id=${post.id}" class="thread__title" data-id="${post.id}">${post.title}</a>
            </div>
            <p class="thread__excerpt">${post.content[0]}</p>
            <div class="thread__meta">
              <span class="author">
                <span class="avatar" aria-hidden="true">${post.author.avatar}</span>
                <a href="#" class="author__name">${post.author.name}</a>
              </span>
              <time datetime="${post.date}">${formatDate(post.date)}</time>
              <span class="dot" aria-hidden="true">•</span>
              ${post.tags.map(tag => `<a href="#" class="tag">${tag}</a>`).join('')}
            </div>
          </div>
          <ul class="thread__stats">
            <li><span class="stat__label">Views</span><strong>${post.stats.views}</strong></li>
            <li><span class="stat__label">Replies</span><strong>${post.stats.replies}</strong></li>
            <li><span class="stat__label">Credibility</span><strong>${post.stats.credibility}</strong></li>
          </ul>
        `;
        threads.appendChild(article);
      });
    }

    function renderPagination() {
      const pagination = document.getElementById('pagination');
      pagination.innerHTML = '';
      const totalPages = Math.ceil(posts.length / POSTS_PER_PAGE);
      // Prev
      const prev = document.createElement('a');
      prev.className = 'page' + (currentPage === 1 ? ' is-disabled' : '');
      prev.href = '#';
      prev.setAttribute('aria-disabled', currentPage === 1 ? 'true' : 'false');
      prev.textContent = 'Prev';
      prev.onclick = e => { e.preventDefault(); if(currentPage > 1){ currentPage--; renderPosts(); renderPagination(); } };
      pagination.appendChild(prev);
      // Pages
      for(let i=1; i<=totalPages; i++){
        if(i === 1 || i === totalPages || Math.abs(i-currentPage)<=1){
          const page = document.createElement('a');
          page.className = 'page' + (i === currentPage ? ' is-current' : '');
          page.href = '#';
          page.setAttribute('aria-current', i === currentPage ? 'page' : 'false');
          page.textContent = i;
          page.onclick = e => { e.preventDefault(); currentPage = i; renderPosts(); renderPagination(); };
          pagination.appendChild(page);
        }else if(i === currentPage-2 || i === currentPage+2){
          const dots = document.createElement('span');
          dots.className = 'page page--dots';
          dots.textContent = '…';
          pagination.appendChild(dots);
        }
      }
      // Next
      const next = document.createElement('a');
      next.className = 'page' + (currentPage === totalPages ? ' is-disabled' : '');
      next.href = '#';
      next.setAttribute('aria-disabled', currentPage === totalPages ? 'true' : 'false');
      next.textContent = 'Next';
      next.onclick = e => { e.preventDefault(); if(currentPage < totalPages){ currentPage++; renderPosts(); renderPagination(); } };
      pagination.appendChild(next);
    }

    function formatDate(dateStr){
      const d = new Date(dateStr);
      return d.toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'});
    }
  </script>
</body>
</html>
